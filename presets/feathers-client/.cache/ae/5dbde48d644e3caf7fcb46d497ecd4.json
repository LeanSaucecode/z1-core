{"id":"HkZi","dependencies":[{"name":"/Users/barry/Documents/code/z1-core/presets/feathers-client/package.json","includedInParent":true,"mtime":1578423419331},{"name":"/Users/barry/Documents/code/z1-core/presets/feathers-client/node_modules/@feathersjs/authentication-client/package.json","includedInParent":true,"mtime":1576530431790},{"name":"@feathersjs/errors","loc":{"line":3,"column":25},"parent":"/Users/barry/Documents/code/z1-core/presets/feathers-client/node_modules/@feathersjs/authentication-client/lib/core.js","resolved":"/Users/barry/Documents/code/z1-core/presets/feathers-client/node_modules/@feathersjs/errors/lib/index.js"},{"name":"./storage","loc":{"line":4,"column":26},"parent":"/Users/barry/Documents/code/z1-core/presets/feathers-client/node_modules/@feathersjs/authentication-client/lib/core.js","resolved":"/Users/barry/Documents/code/z1-core/presets/feathers-client/node_modules/@feathersjs/authentication-client/lib/storage.js"}],"generated":{"js":"var $HkZi$exports={};function $HkZi$var$_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function $HkZi$var$_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $HkZi$var$_createClass(e,t,r){return t&&$HkZi$var$_defineProperties(e.prototype,t),r&&$HkZi$var$_defineProperties(e,r),e}function $HkZi$var$_slicedToArray(e,t){return $HkZi$var$_arrayWithHoles(e)||$HkZi$var$_iterableToArrayLimit(e,t)||$HkZi$var$_nonIterableRest()}function $HkZi$var$_nonIterableRest(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}function $HkZi$var$_iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(c){i=!0,o=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}function $HkZi$var$_arrayWithHoles(e){if(Array.isArray(e))return e}Object.defineProperty($HkZi$exports,\"__esModule\",{value:!0});var $HkZi$var$errors_1=$parcel$require(\"HkZi\",\"@feathersjs/errors\"),$HkZi$var$storage_1=$parcel$require(\"HkZi\",\"./storage\"),$HkZi$var$getMatch=function(e,t){var r=new RegExp(\"(?:&?)\".concat(t,\"=([^&]*)\")),n=e.hash?e.hash.match(r):null;return null!==n?[$HkZi$var$_slicedToArray(n,2)[1],r]:[null,r]},$HkZi$var$AuthenticationClient=function(){function e(t,r){$HkZi$var$_classCallCheck(this,e);var n=t.io||t.primus,i=new $HkZi$var$storage_1.StorageWrapper(t.get(\"storage\")||r.storage);this.app=t,this.options=r,this.authenticated=!1,this.app.set(\"storage\",i),n&&this.handleSocket(n)}return $HkZi$var$_createClass(e,[{key:\"handleSocket\",value:function(e){var t=this,r=this.app.io?\"connect\":\"open\",n=this.app.io?\"disconnect\":\"disconnection\";e.on(n,function(){var n=new Promise(function(t){return e.once(r,function(){return t()})}).then(function(){return t.authenticated?t.reAuthenticate(!0):null});t.app.set(\"authentication\",n)})}},{key:\"getFromLocation\",value:function(e){var t=$HkZi$var$_slicedToArray($HkZi$var$getMatch(e,this.options.locationKey),2),r=t[0],n=t[1];if(null!==r)return e.hash=e.hash.replace(n,\"\"),Promise.resolve(r);var i=$HkZi$var$_slicedToArray($HkZi$var$getMatch(e,this.options.locationErrorKey),2),o=i[0],a=i[1];return null!==o?(e.hash=e.hash.replace(a,\"\"),Promise.reject(new $HkZi$var$errors_1.NotAuthenticated(decodeURIComponent(o)))):Promise.resolve(null)}},{key:\"setAccessToken\",value:function(e){return this.storage.setItem(this.options.storageKey,e)}},{key:\"getAccessToken\",value:function(){var e=this;return this.storage.getItem(this.options.storageKey).then(function(t){return!t&&\"undefined\"!=typeof window&&window.location?e.getFromLocation(window.location):t||null})}},{key:\"removeAccessToken\",value:function(){return this.storage.removeItem(this.options.storageKey)}},{key:\"reset\",value:function(){return this.app.set(\"authentication\",null),this.authenticated=!1,Promise.resolve(null)}},{key:\"handleError\",value:function(e,t){var r=this;if(401===e.code||403===e.code){var n=this.removeAccessToken().then(function(){return r.reset()});return\"logout\"===t?n:n.then(function(){return Promise.reject(e)})}return Promise.reject(e)}},{key:\"reAuthenticate\",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.app.get(\"authentication\");return r&&!0!==t?r:this.getAccessToken().then(function(t){if(!t)throw new $HkZi$var$errors_1.NotAuthenticated(\"No accessToken found in storage\");return e.authenticate({strategy:e.options.jwtStrategy,accessToken:t})})}},{key:\"authenticate\",value:function(e,t){var r=this;if(!e)return this.reAuthenticate();var n=this.service.create(e,t).then(function(e){var t=e.accessToken;return r.authenticated=!0,r.app.emit(\"login\",e),r.app.emit(\"authenticated\",e),r.setAccessToken(t).then(function(){return e})}).catch(function(e){return r.handleError(e,\"authenticate\")});return this.app.set(\"authentication\",n),n}},{key:\"logout\",value:function(){var e=this;return Promise.resolve(this.app.get(\"authentication\")).then(function(){return e.service.remove(null).then(function(t){return e.removeAccessToken().then(function(){return e.reset()}).then(function(){return e.app.emit(\"logout\",t),t})})}).catch(function(t){return e.handleError(t,\"logout\")})}},{key:\"service\",get:function(){return this.app.service(this.options.path)}},{key:\"storage\",get:function(){return this.app.get(\"storage\")}}]),e}(),$HkZi$export$AuthenticationClient=$HkZi$var$AuthenticationClient;$HkZi$exports.AuthenticationClient=$HkZi$export$AuthenticationClient;"},"sourceMaps":null,"error":null,"hash":"82fd2f6cf25d5a05c9b2842356dd722a","cacheData":{"env":{},"imports":{"$require$@feathersjs/errors":["@feathersjs/errors","*"],"$require$./storage":["./storage","*"]},"exports":{"AuthenticationClient":"$HkZi$export$AuthenticationClient"},"wildcards":[],"sideEffects":true,"isCommonJS":true}}